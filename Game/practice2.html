<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Race Day</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/F1 Logo.jpeg" rel="icon">
  <!--<link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">-->

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">
  <script src="https://kit.fontawesome.com/3772469bf7.js" crossorigin="anonymous"></script>

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: NiceAdmin - v2.2.2
  * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>
      <!-- ======= Header ======= -->
  <header id="header" class="fixed-top d-flex align-items-cente">
    <div class="container-fluid container-xl d-flex align-items-center justify-content-lg-between">

      <!--<h1 class="logo me-auto me-lg-0"><a href="index.html">Restaurantly</a></h1>-->
      <a href="index-2.html" class="logo me-auto me-lg-0"><img src="assets/img/Logo_2.png" alt="" class="img-fluid"></a>
      <script>
        function Signout() {
          sessionStorage.removeItem('user');
          localStorage.removeItem('user');
          localStorage.removeItem('keepLoggedIn');
          window.location = '/';
        }
      </script>
      <nav id="navbar" class="navbar order-last order-lg-0">
        <ul>
          <i class="fa-solid fa-wallet fa-1x" style="color: #cda45e;"></i>
          <li id="VirtualCurrency" style="color: #cda45e; margin-right: 200px; margin-left: 10px; font-size: 20px;" ></li>
          <li><i class = "fa-solid fa-user" id="UserName" style="color: #cda45e; margin-right: 200px;"></i></li>
          <li><button class="book-a-table-btn scrollto d-none d-lg-flex" onclick="Signout()">Sign Out</button></li>
        </ul>
        <script type = "module" src = "./assets/js/VirtualCurrency.js"></script>
        <script>
          const currentUser = JSON.parse(localStorage.getItem('user'));
          document.getElementById("UserName").innerText = currentUser;
        </script>
          <!--
          <li><a class="nav-link scrollto active" href="#hero">Home</a></li>
          <li><a class="nav-link scrollto" href="#about">About</a></li>
          <li><a class="nav-link scrollto" href="#why-us">How To Play</a></li>
          <li><a class="nav-link scrollto" href="#events">Rewards</a></li>
          <li><a class="nav-link scrollto" href="#menu">Drivers</a></li>
          <li><a class="nav-link scrollto" href="#specials">Store</a></li>
          <li><a class="nav-link scrollto" href="#testimonials">Reviews</a></li>
          -->
        <!--
                  <li class="dropdown"><a href="#"><span>Drop Down</span> <i class="bi bi-chevron-down"></i></a>
            <ul>
              <li><a href="#">Drop Down 1</a></li>
              <li class="dropdown"><a href="#"><span>Deep Drop Down</span> <i class="bi bi-chevron-right"></i></a>
                <ul>
                  <li><a href="#">Deep Drop Down 1</a></li>
                  <li><a href="#">Deep Drop Down 2</a></li>
                  <li><a href="#">Deep Drop Down 3</a></li>
                  <li><a href="#">Deep Drop Down 4</a></li>
                  <li><a href="#">Deep Drop Down 5</a></li>
                </ul>
              </li>
              <li><a href="#">Drop Down 2</a></li>
              <li><a href="#">Drop Down 3</a></li>
              <li><a href="#">Drop Down 4</a></li>
            </ul>
          </li>
          <li><a class="nav-link scrollto" href="#contact">Contact</a></li>
        </ul>
        -->
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->


    </div>
  </header><!-- End Header -->

  <div class = "RaceImg">
    <script type="module" src = "assets/js/whichRace.js"></script>
    <!-- Need change so that we can automate. KIV-->
    <img src = "assets/img/SaudiArabia.jpeg" width="100%" height="380" id="raceImg2">
    <h1 id = "TextOverImg"></h1>
    <button class="raceButton" disabled><span id="raceNum"></span></button>
    <div class = "topnav">
        <ul>
          <li><a href="racePage.html">Circuit</a></li>
          <li><a class = "active" href = "">Draft Selection</a></li>
          <li><a href = "">Configuration</a></li>
          <li><a href = "">Race Results</a></li>
        </ul>
    </div>
</div>
<script>
  const countryName = JSON.parse(localStorage.getItem('currentRaceC'))
  document.getElementById('TextOverImg').innerText = countryName
  const raceNum = JSON.parse(localStorage.getItem('currentRaceNum')) + 1
  document.getElementById('raceNum').innerText = 'Race' + ' ' + `${raceNum}`;
</script>
  <div class="col-12">
    <!--JS FOR DRAFT SELECTION!-->
    <script type="module">
      const firebaseConfig = {
      apiKey: "AIzaSyDZY8ufwFMkPhzOY-dNJm9bGXqv9okoW5g",
      authDomain: "f1-crypto.firebaseapp.com",
      databaseURL: "https://f1-crypto-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "f1-crypto",
      storageBucket: "f1-crypto.appspot.com",
      messagingSenderId: "512980395232",
      appId: "1:512980395232:web:9d81bc5d7c58bc5a13dc85"
        };
      import {initializeApp} from "https://www.gstatic.com/firebasejs/9.8.1/firebase-app.js";
      import { getDatabase, ref, onValue, update, get, set} from "https://www.gstatic.com/firebasejs/9.8.1/firebase-database.js";
      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      //START OF DRIVER DRAFT
      const drivers2 = ['albon', 'alonso', 'bottas', 'gasly', 'hamiliton', 'lafti', 'leclerc', 'magussen', 'norris', 'ocon', 'perez', 'ricardo', 'russell', 'sainz', 'schumacher', 'stroll', 'tsunoda', 'verstappen', 'vettel', 'zhou'];
      const dictt = {Albon: 'albon', Alonso: 'alonso', Bottas: 'bottas', Gasly: 'gasly', Hamiliton: 'hamiliton', Lafti: 'lafti', Leclerc: 'leclerc', Magussen: 'magussen', Norris: 'norris', Ocon: 'ocon', Perez:'perez', Ricardo:'ricardo', Russell:'russell', Sainz: 'sainz', Schumacher:'schumacher', Stroll:'stroll', Tsunoda:'tsunoda', Verstappen:'verstappen', Vettel:'vettel', Zhou:'zhou'};
      const pid = [d1, d2];
      const pid2 = ['d1', 'd2']
      const mapping = {}
      const mapping_dupe = {}
      const btns = ['b1', 'b2']
      const btns2 = ['b5', 'b6']

      const pid22 = [d12, d22]
      const pid222 = ['d12', 'd22']

      const Usr = JSON.parse(localStorage.getItem('usr'));
      const starCountRef = ref(db, 'users/' + Usr.uid);
      var c = 0
      var countt = 0
      
      get(starCountRef).then((snapshot) => {
          const data = snapshot.val();
          //titledraft.innerText = data['drafted'] + '/2  drivers';
          //titledraft2.innerText = data['draftedCars'] +'/2  cars'

              if (data['driverCount'] > 0){
            var li = data['drivers'];
            console.log(li);
            for (var dd in li){
              if (dd != 'nil'){
                mapping[btns[c]] = dd
                mapping_dupe[btns2[c]] = dd
                console.log('<img src="assets/img/drivers/' + dictt[dd]  + '.jpg" class="special"> ' +  dd + '<button class="book-a-table-btn scrollto d-none d-lg-flex" id='+ pid[c] +'>Draft</button>');
                pid[c].innerHTML = '<img src="assets/img/drivers/' + dictt[dd]  + '.jpg" class="special"> ' +  dd + '<button class="draftbtn" id='+ btns[c] +'>Draft</button>';
                pid22[c].innerHTML = '<img src="assets/img/drivers/' + dictt[dd]  + '.jpg" class="special"> ' +  dd + '<button class="draftbtn" id='+ btns2[c] +'>Draft</button>';


                c++;
              }
            }
            console.log(mapping)
            localStorage.setItem('mapping', JSON.stringify(mapping))
            localStorage.setItem('mapping_dupe', JSON.stringify(mapping_dupe))

            //START OF DRIVER DRAFT JS CODE
            //TO RE-IMPLEMENT DRAFTING REPLACE INNERHTML WITH '<img src="assets/img/drivers/' + dictt[dd]  + '.jpg" class="special"> ' +  dd + '<button class="book-a-table-btn scrollto d-none d-lg-flex" id='+ pid[c] +'>Draft</button>'

            //END OF DRIVER DRAFT JS CODE
          }
        })

      get(starCountRef).then((snapshot) => {             
        const data = snapshot.val();
      const cid = [c1, c2];
      const cid2 = ['c1', 'c2']
      const cars = ["RedBull2022", "Ferrari2022", "Mercedes2022", "Mclaren2022", "AlfaRomeo2022", "AlphaTauri2022", "Alpine2022", "AstonMartin2022", "Haas2022", "Williams2022"];
      const dictt2 = {'Red Bull 2022': 'RedBull', 'Ferrari 2022': 'Ferrari', 'Mercedes 2022': 'Mercedes', 'Mclaren 2022': 'Mclaren', 'Alfa Romeo 2022': 'AlfaRomeo','Alpha Tauri 2022':'AlphaTauri', 'Alpine 2022': 'Alpine','Aston Martin 2022':'AstonMartin', 'Haas 2022':'Haas','Williams 2022':'Williams' }                
      const mapping2 = {}
      const mapping2_dupe = {}
      const btns = ['b3', 'b4']
      const btns2 = ['b7', 'b8']

      const cid22 = [c12, c22]
      const cid222 = ['c12', 'c22']

      var c = 0;
      if (data['carCount'] > 0){
        var li2 = data['cars'];
        for (var cc in li2){
              if (cc != 'nil'){
                mapping2[btns[c]] = cc
                mapping2_dupe[btns2[c]] = cc
                console.log('this is cc' + cc)

                console.log('<img src="assets/img/' + dictt2[cc]  + '.png" class="special"> ' +  cc + '<button class="book-a-table-btn scrollto d-none d-lg-flex" id='+ cid[c] +'>Draft</button>');
                cid[c].innerHTML = '<img src="assets/img/' + dictt2[cc]  + '.png" class="special"> ' +  cc + '<button class="draftbtn" id='+ btns[c] +'>Draft</button>';
                cid22[c].innerHTML = '<img src="assets/img/' + dictt2[cc]  + '.png" class="special"> ' +  cc + '<button class="draftbtn" id='+ btns2[c] +'>Draft</button>';

                c++;
              }
            }
        console.log(mapping2);
        localStorage.setItem('mapping2', JSON.stringify(mapping2))
        localStorage.setItem('mapping2_dupe', JSON.stringify(mapping2_dupe))
        //START OF CAR DRAFTING JS CODE 
        //TO RE-IMPLEMENT DRAFTING, REPLACE INNERHTML WITH '<img src="assets/img/' + dictt2[cc]  + '.png" class="special"> ' +  cc + '<button class="book-a-table-btn scrollto d-none d-lg-flex" id='+ cid[c] +'>Draft</button>'

        //END OF CAR DRAFTING JS CODE             
      }
    })

    get(starCountRef).then((snapshot) => {
      const data = snapshot.val();
      const mapping = JSON.parse(localStorage.getItem('mapping'));
      const mapping_dupe = JSON.parse(localStorage.getItem('mapping_dupe'))
      const mapping2_dupe = JSON.parse(localStorage.getItem('mapping2_dupe'))
      const mapping2 = JSON.parse(localStorage.getItem('mapping2'))

      const pair1 = [d1, d2, c1, c2]
      const pair1s = ['d1', 'd2', 'c1', 'c2']
      const pair2 = [d12,d22, c12, c22]
      const pair2s = ['d12', 'd22', 'c12', 'c22']
      const mapping_combi = Object.assign({}, mapping, mapping2)
      const mapping_combi_dupe = Object.assign({}, mapping_dupe, mapping2_dupe)
      var p1DCount = data['poneD'];
      var p1CCount = data['poneC'];
      const btns1 = [b1, b2,b3,b4, b5, b6,b7,b8]
      const btns1s = ['b1', 'b2', 'b3', 'b4']
      const btns2 = [b5, b6,b7,b8]
      const btns2s = ['b5', 'b6', 'b7', 'b8']

      var p2DCount = data['ptwoD'];
      var p2CCount = data['ptwoC'];
      
      for (var i = 0;i < 4;i++){
          (function() {
                const elementt = btns1s[i]
                const elementt2 = btns2s[i]
                btns1[i].addEventListener('click', (e) => { 
                  
                  if (mapping_combi[elementt] in data['drivers']){
                    if (mapping_combi[elementt] in data['pair2']){
                      alert("Driver has already been drafted in Pair 2")
                    }

                    else if (p1DCount == 1){
                      alert("Pair 1 already has a driver")
                    }

                    else{
                      p1DCount += 1 
                      var old = data['pair1']
                      old[mapping_combi[elementt]] = 1 
                      update(ref(db, 'users/' + Usr.uid), {
                        'pair1': old,
                        'poneD': p1DCount
                      })
                      var buttonz = document.getElementById(elementt);
                      console.log(buttonz);
                      buttonz.style.opacity = 0.5;

                      var buttonz2 = document.getElementById(elementt2);
                      console.log(buttonz2);
                      buttonz2.style.opacity = 0.5;
                    }
                  }

                  if (mapping_combi[elementt] in data['cars']){
                    if (mapping_combi[elementt] in data['pair2']){
                      alert("Car has already been drafted in Pair 2")
                    }

                    else if (p1CCount == 1){
                      alert("Pair 1 already has a car")
                    }

                    else{
                      p1CCount += 1 
                      var old = data['pair1']
                      old[mapping_combi[elementt]] = 1 
                      update(ref(db, 'users/' + Usr.uid), {
                        'pair1': old,
                        'poneC': p1CCount
                      })
                      var buttonz = document.getElementById(elementt);
                      console.log(buttonz);
                      buttonz.style.opacity = 0.5;

                      var buttonz2 = document.getElementById(elementt2);
                      console.log(buttonz2);
                      buttonz2.style.opacity = 0.5;



                    }
                  }
                

                })
                


              }())//FUNCTION 
                }//FIRST FOR LOOP
                for (var i = 0;i < 4;i++){
          (function() {
                const elementt = btns2s[i]
                const elementt2 = btns1s[i]
                btns2[i].addEventListener('click', (e) => { 
                  if (mapping_combi_dupe[elementt] in data['drivers']){
                    if (mapping_combi_dupe[elementt] in data['pair1']){
                      alert("Driver has already been drafted in Pair 1")
                    }

                    else if (p2DCount == 1){
                      alert("Pair 2 already has a driver")
                    }

                    else{
                      p2DCount += 1 
                      var old = data['pair2']
                      old[mapping_combi_dupe[elementt]] = 1 
                      update(ref(db, 'users/' + Usr.uid), {
                        'pair2': old,
                        'ptwoD': p2DCount
                      })
                      var buttonz = document.getElementById(elementt);
                      console.log(buttonz);
                      buttonz.style.opacity = 0.5;

                      var buttonz2 = document.getElementById(elementt2);
                      console.log(buttonz2);
                      buttonz2.style.opacity = 0.5;

                    }
                  }

                  if (mapping_combi_dupe[elementt] in data['cars']){
                    if (mapping_combi_dupe[elementt] in data['pair1']){
                      alert("Car has already been drafted in Pair 1")
                    }

                    else if (p2CCount == 1){
                      alert("Pair 2 already has a car")
                    }

                    else{
                      p2CCount += 1 
                      var old = data['pair2']
                      old[mapping_combi_dupe[elementt]] = 1 
                      update(ref(db, 'users/' + Usr.uid), {
                        'pair2': old,
                        'ptwoC': p1CCount
                      })
                      var buttonz = document.getElementById(elementt);
                      console.log(buttonz);
                      buttonz.style.opacity = 0.5;

                      var buttonz2 = document.getElementById(elementt2);
                      console.log(buttonz2);
                      buttonz2.style.opacity = 0.5;

                    }
                  }
                

                })
                


              }())//SECOND FUNCTION 
                }//SECOND FOR LOOP
              
              })// SNAPSHOT


                   
      






    </script>



    <h4 class="card-title" style="font-size: 24px; margin-left: 1%;">My Draft </h4>
    <!-- PAIR ONE SELECTION -->
    <div class="draftheader">Pair 1</div>
    <div class = 'draftheader' >Pair 2</div>
    <div class="card">

      <div class="card-body">
        <!--<h5 class="card-title" id="titledraft">0/2 Drivers</h5>-->
        <h5 class = 'card-title'>Driver 1</h5>
        <p id = 'd1'><button id = 'b1'></button></p>
      </div>

      <div class="card-body">
        <!--<h5 class="card-title" id="titledraft">0/2 Drivers</h5>-->
        <h5 class = 'card-title'>Driver 2</h5>
        <p id = 'd2'><button id = 'b2'></button></p>
      </div>

      <div class="card-body">
        <!--<h5 class="card-title" id="titledraft2">0/2 Cars</h5>-->
        <h5 class = 'card-title'>Car 1</h5>
        <p id = 'c1'><button id = 'b3'></button></p>
      </div>

    <div class="card-body">
      <!--<h5 class="card-title" id="titledraft2">0/2 Cars</h5>-->
      <h5 class = 'card-title'>Car 2</h5>
      <p id = 'c2'><button id = 'b4'></button></p>
    </div>

    </div>
    
    <!-- PAIR TWO SELECTION -->
    <div class="card">

      <div class="card-body">
        <!--<h5 class="card-title" id="titledraft">0/2 Drivers</h5>-->
        <h5 class = 'card-title'>Driver 1</h5>
        <p id = 'd12'><button></button></p>
      </div>

      <div class="card-body">
        <!--<h5 class="card-title" id="titledraft">0/2 Drivers</h5>-->
        <h5 class = 'card-title'>Driver 2</h5>
        <p id = 'd22'><button></button></p>
      </div>

      <div class="card-body">
        <!--<h5 class="card-title" id="titledraft2">0/2 Cars</h5>-->
        <h5 class = 'card-title'>Car 1</h5>
        <p id = 'c12'><button></button></p>
      </div>

    <div class="card-body">
      <!--<h5 class="card-title" id="titledraft2">0/2 Cars</h5>-->
      <h5 class = 'card-title'>Car 2</h5>
      <p id = 'c22'><button></button></p>
    </div>

    </div>







</div>
</body>